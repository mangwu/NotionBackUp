# 对内存管理有利的JavaScript代码写法

开发者的代码风格和写法对JavaScript引擎的内存管理是有影响的，好的影响包括性能优化，提升运行速度，坏的影响可导致内存泄漏

# 1. 通过const和let声明提升性能

## 描述

- ES6新增的这两个声明关键字声明的变量都是块作用域的
- 相比于var声明的函数作用域变量，**块作用域变量可能会更早地让垃圾回收程序介入**

## 原理

- 在块作用域，如条件语句，循环语句中
    - 使用const和let声明地变量是局部变量
    - 是var声明地变量不是局部变量
- 在退出块作用域的上下文后
    - 其中的局部变量被销毁，无法再访问到
    - var声明的变量在父作用域仍然可以访问到
    - 垃圾回收程序会优先回收let和const声明的局部变量
- 本质上是因为
    - var声明的变量在块作用域中不会挂载到块的上下文变量对象中
    - 而是挂载到父函数上下文或全局上下文的变量对象中
    - 而let和const声明的变量仅进入当前上下文中
    - 块执行完毕后，上下文变更，let和const声明的变量不存在作用域链中的任何上下文的变量对象中，而var声明的变量仍然存在于某一函数上下文或全局上下文的变量对象中
    - 垃圾回层序标记所有存在内存中的变量值，去除当前作用域链中所有上下文的变量对象中的变量的标记，剩下有标记的被清除（包括上下文变更前声明的局部变量值）

# 2. 隐藏类和删除操作

## 描述

- 关于隐藏类可以查看如下专栏
    
    [V8中的隐藏类（Hidden Classes）和内联缓存（Inline Caching）](https://zhuanlan.zhihu.com/p/469962133)
    
    [隐藏类和内联缓存](%E5%AF%B9%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%89%E5%88%A9%E7%9A%84JavaScript%E4%BB%A3%E7%A0%81%E5%86%99%E6%B3%95%20e10ddf54737c4f948b79f35a6762853e/%E9%9A%90%E8%97%8F%E7%B1%BB%E5%92%8C%E5%86%85%E8%81%94%E7%BC%93%E5%AD%98%20e37eaf8f728e46859e15fedf21c31d1a.md)